<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°íšì „ ìŠ¤í¬ë¡¤ ëìŠ¤ ë¶„ì„ ëŒ€ì‹œë³´ë“œ (Snowflake)</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', 'Segoe UI', sans-serif;
            background: #ffffff;
            padding: 30px;
            color: #1a1a1a;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: #ffffff;
            padding: 30px;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .header h1 {
            color: #1a1a1a;
            font-size: 2.4em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .table-container {
            background: #ffffff;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            overflow-x: auto;
            border: 1px solid #e5e7eb;
            margin-bottom: 30px;
        }

        .table-container h2 {
            color: #1a1a1a;
            font-size: 1.5em;
            margin-bottom: 18px;
            font-weight: 700;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #f8f9ff;
            font-weight: 600;
            color: #1a1a1a;
        }

        tr:hover {
            background: #f9fafb;
        }

        .chart-container {
            background: #ffffff;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            border: 1px solid #e5e7eb;
            margin-bottom: 30px;
        }

        .chart-container h2 {
            color: #1a1a1a;
            font-size: 1.5em;
            margin-bottom: 24px;
            font-weight: 700;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .insights-container {
            background: #ffffff;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            border: 1px solid #e5e7eb;
            margin-bottom: 30px;
        }

        .insights-container h2 {
            color: #1a1a1a;
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .insight-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .insight-card.excellent {
            background: #dcfce7;
            border-left-color: #22c55e;
        }

        .insight-card.warning {
            background: #fef3c7;
            border-left-color: #f59e0b;
        }

        .insight-card.alert {
            background: #fee2e2;
            border-left-color: #ef4444;
        }

        .insight-card h3 {
            color: #1a1a1a;
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .insight-card ul {
            list-style: none;
            padding: 0;
        }

        .insight-card li {
            color: #374151;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 8px;
            padding-left: 8px;
        }

        .insight-card strong {
            color: #1a1a1a;
            font-weight: 600;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            background: #ffffff;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9ff;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-family: 'Pretendard', 'Segoe UI', sans-serif;
        }

        .tab-button:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-button.active {
            color: #667eea;
            background: #ffffff;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š TOP 5 ê¸°íšì „ ìŠ¤í¬ë¡¤ ëìŠ¤ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
            <p style="color:#6b7280; font-weight:500;">ê¸°ê°„: 2025ë…„ 12ì›” 8ì¼ ~ 12ì›” 14ì¼ (Snowflake ë°ì´í„°)</p>
            <p style="color:#6b7280; font-size:0.9em; margin-top:5px;">í˜ì´ì§€ë·° ê¸°ì¤€ TOP 5 ê¸°íšì „ì˜ ìŠ¤í¬ë¡¤ ì°¸ì—¬ë„ ë¶„ì„</p>
        </div>

        <!-- íƒ­ -->
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('X')">
                    ğŸ”µ ë””ìŠ¤ì»¤ë²„ë¦¬ (X)
                </button>
                <button class="tab-button" onclick="switchTab('M')">
                    âš¾ MLB (M)
                </button>
                <button class="tab-button" onclick="switchTab('V')">
                    ğŸ§¥ ë“€ë² í‹°ì¹´ (V)
                </button>
                <button class="tab-button" onclick="switchTab('ST')">
                    ğŸ·ï¸ ST (ST)
                </button>
            </div>
        </div>

        <!-- X ë¸Œëœë“œ (ë””ìŠ¤ì»¤ë²„ë¦¬) íƒ­ -->
        <div id="tab-X" class="tab-content active">
            <div class="insights-container">
                <h2>ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h2>
                <div id="insightsContentX"></div>
            </div>

            <div class="table-container">
                <h2>ğŸ† TOP 5 ê¸°íšì „ ìŠ¤í¬ë¡¤ ëìŠ¤ í†µê³„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ìˆœìœ„</th>
                            <th>ê¸°íšì „ ë²ˆí˜¸</th>
                            <th>í˜ì´ì§€ ì œëª©</th>
                            <th>í˜ì´ì§€ë·°</th>
                            <th>25% ë„ë‹¬</th>
                            <th>50% ë„ë‹¬</th>
                            <th>75% ë„ë‹¬</th>
                            <th>95% ë„ë‹¬</th>
                            <th>ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸</th>
                            <th>95% ë„ë‹¬ë¥ </th>
                        </tr>
                    </thead>
                    <tbody id="scrollDepthTableBodyX"></tbody>
                </table>
            </div>

            <div class="chart-container">
                <h2>ğŸ“Š TOP 5 ê¸°íšì „ë³„ ìŠ¤í¬ë¡¤ ëìŠ¤ ë¹„êµ ì°¨íŠ¸</h2>
                <div class="chart-wrapper">
                    <canvas id="scrollDepthChartX"></canvas>
                </div>
            </div>
        </div>

        <!-- M ë¸Œëœë“œ (MLB) íƒ­ -->
        <div id="tab-M" class="tab-content">
            <div class="insights-container">
                <h2>ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h2>
                <div id="insightsContentM"></div>
            </div>

            <div class="table-container">
                <h2>ğŸ† TOP 5 ê¸°íšì „ ìŠ¤í¬ë¡¤ ëìŠ¤ í†µê³„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ìˆœìœ„</th>
                            <th>ê¸°íšì „ ë²ˆí˜¸</th>
                            <th>í˜ì´ì§€ ì œëª©</th>
                            <th>í˜ì´ì§€ë·°</th>
                            <th>25% ë„ë‹¬</th>
                            <th>50% ë„ë‹¬</th>
                            <th>75% ë„ë‹¬</th>
                            <th>95% ë„ë‹¬</th>
                            <th>ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸</th>
                            <th>95% ë„ë‹¬ë¥ </th>
                        </tr>
                    </thead>
                    <tbody id="scrollDepthTableBodyM"></tbody>
                </table>
            </div>

            <div class="chart-container">
                <h2>ğŸ“Š TOP 5 ê¸°íšì „ë³„ ìŠ¤í¬ë¡¤ ëìŠ¤ ë¹„êµ ì°¨íŠ¸</h2>
                <div class="chart-wrapper">
                    <canvas id="scrollDepthChartM"></canvas>
                </div>
            </div>
        </div>

        <!-- V ë¸Œëœë“œ (ë“€ë² í‹°ì¹´) íƒ­ -->
        <div id="tab-V" class="tab-content">
            <div class="insights-container">
                <h2>ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h2>
                <div id="insightsContentV"></div>
            </div>

            <div class="table-container">
                <h2>ğŸ† TOP 5 ê¸°íšì „ ìŠ¤í¬ë¡¤ ëìŠ¤ í†µê³„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ìˆœìœ„</th>
                            <th>ê¸°íšì „ ë²ˆí˜¸</th>
                            <th>í˜ì´ì§€ ì œëª©</th>
                            <th>í˜ì´ì§€ë·°</th>
                            <th>25% ë„ë‹¬</th>
                            <th>50% ë„ë‹¬</th>
                            <th>75% ë„ë‹¬</th>
                            <th>95% ë„ë‹¬</th>
                            <th>ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸</th>
                            <th>95% ë„ë‹¬ë¥ </th>
                        </tr>
                    </thead>
                    <tbody id="scrollDepthTableBodyV"></tbody>
                </table>
            </div>

            <div class="chart-container">
                <h2>ğŸ“Š TOP 5 ê¸°íšì „ë³„ ìŠ¤í¬ë¡¤ ëìŠ¤ ë¹„êµ ì°¨íŠ¸</h2>
                <div class="chart-wrapper">
                    <canvas id="scrollDepthChartV"></canvas>
                </div>
            </div>
        </div>

        <!-- ST ë¸Œëœë“œ íƒ­ -->
        <div id="tab-ST" class="tab-content">
            <div class="insights-container">
                <h2>ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h2>
                <div id="insightsContentST"></div>
            </div>

            <div class="table-container">
                <h2>ğŸ† TOP 5 ê¸°íšì „ ìŠ¤í¬ë¡¤ ëìŠ¤ í†µê³„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ìˆœìœ„</th>
                            <th>ê¸°íšì „ ë²ˆí˜¸</th>
                            <th>í˜ì´ì§€ ì œëª©</th>
                            <th>í˜ì´ì§€ë·°</th>
                            <th>25% ë„ë‹¬</th>
                            <th>50% ë„ë‹¬</th>
                            <th>75% ë„ë‹¬</th>
                            <th>95% ë„ë‹¬</th>
                            <th>ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸</th>
                            <th>95% ë„ë‹¬ë¥ </th>
                        </tr>
                    </thead>
                    <tbody id="scrollDepthTableBodyST"></tbody>
                </table>
            </div>

            <div class="chart-container">
                <h2>ğŸ“Š TOP 5 ê¸°íšì „ë³„ ìŠ¤í¬ë¡¤ ëìŠ¤ ë¹„êµ ì°¨íŠ¸</h2>
                <div class="chart-wrapper">
                    <canvas id="scrollDepthChartST"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scrollDepthDataX = [
            {
                        "promotion_number": "1512",
                        "promotion_name": "ê¸°íšì „ #1512",
                        "page_title": "ë””ìŠ¤ì»¤ë²„ë¦¬ ìµìŠ¤í˜ë””ì…˜ - ê²¨ìš¸ ìŠ¤íƒ€ì¼ì„ ì™„ì„±í•˜ëŠ” ìœˆí„° ë¶€ì¸ ",
                        "page_views": 214338,
                        "depth_25": 49592,
                        "depth_50": 29408,
                        "depth_75": 15082,
                        "depth_95": 9492,
                        "total_events": 103574
            },
            {
                        "promotion_number": "1574",
                        "promotion_name": "ê¸°íšì „ #1574",
                        "page_title": "ë””ìŠ¤ì»¤ë²„ë¦¬ ìµìŠ¤í˜ë””ì…˜ - The Premium Winter Down",
                        "page_views": 116234,
                        "depth_25": 21862,
                        "depth_50": 17065,
                        "depth_75": 8368,
                        "depth_95": 5390,
                        "total_events": 52685
            },
            {
                        "promotion_number": "1549",
                        "promotion_name": "ê¸°íšì „ #1549",
                        "page_title": "ë””ìŠ¤ì»¤ë²„ë¦¬ ìµìŠ¤í˜ë””ì…˜ - ì‹œê·¸ë‹ˆì²˜ ì‚¬íŒŒë¦¬ êµ¬ìŠ¤ë‹¤ìš´, ë°€í¬ë“œ ë² ë¥´í…ìŠ¤",
                        "page_views": 92738,
                        "depth_25": 14569,
                        "depth_50": 11635,
                        "depth_75": 8281,
                        "depth_95": 4502,
                        "total_events": 38987
            },
            {
                        "promotion_number": "1514",
                        "promotion_name": "ê¸°íšì „ #1514",
                        "page_title": "ë””ìŠ¤ì»¤ë²„ë¦¬ ìµìŠ¤í˜ë””ì…˜ - í”„ë¦¬ë¯¸ì—„ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ìœ„í•œ ë ˆìŠ¤í„°G",
                        "page_views": 83110,
                        "depth_25": 17855,
                        "depth_50": 8804,
                        "depth_75": 4380,
                        "depth_95": 2699,
                        "total_events": 33738
            },
            {
                        "promotion_number": "1548",
                        "promotion_name": "ê¸°íšì „ #1548",
                        "page_title": "ë””ìŠ¤ì»¤ë²„ë¦¬ ìµìŠ¤í˜ë””ì…˜ - ë¹›ë‚˜ëŠ” ê²¨ìš¸ì„ ìœ„í•œ í”„ë¦¬ë¯¸ì—„ í‚¤ì¦ˆ ì•„ìš°í„°",
                        "page_views": 47810,
                        "depth_25": 8323,
                        "depth_50": 2266,
                        "depth_75": 1317,
                        "depth_95": 986,
                        "total_events": 12892
            }
];
        const scrollDepthDataM = [
            {
                        "promotion_number": "1520",
                        "promotion_name": "ê¸°íšì „ #1520",
                        "page_title": "ì— ì—˜ë¹„ ì½”ë¦¬ì•„ - ì¹´ë¦¬ë‚˜ì˜ ê²¨ìš¸ ì‹¤ë£¨ì—£ CURVE THE WINTER",
                        "page_views": 74936,
                        "depth_25": 4732,
                        "depth_50": 3427,
                        "depth_75": 2699,
                        "depth_95": 2505,
                        "total_events": 13363
            },
            {
                        "promotion_number": "1571",
                        "promotion_name": "ê¸°íšì „ #1571",
                        "page_title": "ì— ì—˜ë¹„ ì½”ë¦¬ì•„ - LITE ON, MOVE ON! MLB KIDS ì‹ í•™ê¸° ì±…ê°€ë°©",
                        "page_views": 35442,
                        "depth_25": 6784,
                        "depth_50": 3675,
                        "depth_75": 2191,
                        "depth_95": 1878,
                        "total_events": 14528
            },
            {
                        "promotion_number": "1557",
                        "promotion_name": "ê¸°íšì „ #1557",
                        "page_title": "ì— ì—˜ë¹„ ì½”ë¦¬ì•„ - ì¹´ë¦¬ë‚˜ PICK! í”ŒëŸ¬ì‹œ ë¯¸ì•¼ì˜¹ ë¹„ë‹ˆ ë¦¬ìŠ¤íƒ",
                        "page_views": 35282,
                        "depth_25": 2869,
                        "depth_50": 1935,
                        "depth_75": 1656,
                        "depth_95": 1475,
                        "total_events": 7935
            },
            {
                        "promotion_number": "1570",
                        "promotion_name": "ê¸°íšì „ #1570",
                        "page_title": "ì— ì—˜ë¹„ ì½”ë¦¬ì•„ - WINTERâ€™S HEAT WAVE SHOES COLLECTION",
                        "page_views": 24126,
                        "depth_25": 5590,
                        "depth_50": 3980,
                        "depth_75": 2652,
                        "depth_95": 1530,
                        "total_events": 13752
            },
            {
                        "promotion_number": "1576",
                        "promotion_name": "ê¸°íšì „ #1576",
                        "page_title": "ì— ì—˜ë¹„ ì½”ë¦¬ì•„ - Gift for Love THANKS WEEK",
                        "page_views": 14486,
                        "depth_25": 2016,
                        "depth_50": 1195,
                        "depth_75": 645,
                        "depth_95": 434,
                        "total_events": 4290
            }
];
        const scrollDepthDataV = [
            {
                        "promotion_number": "1587",
                        "promotion_name": "ê¸°íšì „ #1587",
                        "page_title": "ë“€ë² í‹°ì¹´ ê³µì‹ ì˜¨ë¼ì¸ëª° - WINTER MOMENT with Ki Eunse - COLLECTION",
                        "page_views": 160778,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1555",
                        "promotion_name": "ê¸°íšì „ #1555",
                        "page_title": "ë“€ë² í‹°ì¹´ ê³µì‹ ì˜¨ë¼ì¸ëª° - DUVETICA with Kim Jiwon - COLLECTION",
                        "page_views": 122630,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1537",
                        "promotion_name": "ê¸°íšì „ #1537",
                        "page_title": "ë“€ë² í‹°ì¹´ ê³µì‹ ì˜¨ë¼ì¸ëª° - FIOCCA THE ICON OF WINTER - COLLECTION",
                        "page_views": 29420,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1545",
                        "promotion_name": "ê¸°íšì „ #1545",
                        "page_title": "ë“€ë² í‹°ì¹´ ê³µì‹ ì˜¨ë¼ì¸ëª° - THE SIGNATURE TEXTURES - COLLECTION",
                        "page_views": 21464,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1479",
                        "promotion_name": "ê¸°íšì „ #1479",
                        "page_title": "ë“€ë² í‹°ì¹´ ê³µì‹ ì˜¨ë¼ì¸ëª° - EURIPEDE, A CURATED LIFESTYLE - COLLECTION",
                        "page_views": 13860,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            }
];
        const scrollDepthDataST = [
            {
                        "promotion_number": "1552",
                        "promotion_name": "ê¸°íšì „ #1552",
                        "page_title": "Sergio Tacchini ê³µì‹ ì˜¨ë¼ì¸ëª° - Feature | WINTER Fleece Moment",
                        "page_views": 3786,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1546",
                        "promotion_name": "ê¸°íšì „ #1546",
                        "page_title": "Sergio Tacchini ê³µì‹ ì˜¨ë¼ì¸ëª° - Feature | Park Ji-hyun with Tacchini Winter Down",
                        "page_views": 1846,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1536",
                        "promotion_name": "ê¸°íšì „ #1536",
                        "page_title": "Sergio Tacchini ê³µì‹ ì˜¨ë¼ì¸ëª° - Feature | Urban Fleece collection",
                        "page_views": 1746,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1538",
                        "promotion_name": "ê¸°íšì „ #1538",
                        "page_title": "Sergio Tacchini ê³µì‹ ì˜¨ë¼ì¸ëª° - Feature | Winter Down for Active Lifestyles",
                        "page_views": 1716,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            },
            {
                        "promotion_number": "1573",
                        "promotion_name": "ê¸°íšì „ #1573",
                        "page_title": "Sergio Tacchini ê³µì‹ ì˜¨ë¼ì¸ëª° - Feature | Winter Texture Down",
                        "page_views": 762,
                        "depth_25": 0,
                        "depth_50": 0,
                        "depth_75": 0,
                        "depth_95": 0,
                        "total_events": 0
            }
];
        
        let chartX = null;
        let chartM = null;
        let chartV = null;
        let chartST = null;

        function getShortTitle(pageTitle, brand) {
            if (!pageTitle) return '';
            // X ë¸Œëœë“œ: "ë””ìŠ¤ì»¤ë²„ë¦¬ ìµìŠ¤í˜ë””ì…˜ - " ì œê±°
            if (brand === 'X') {
                const prefix = 'ë””ìŠ¤ì»¤ë²„ë¦¬ ìµìŠ¤í˜ë””ì…˜ - ';
                if (pageTitle.startsWith(prefix)) {
                    return pageTitle.substring(prefix.length);
                }
            }
            // M ë¸Œëœë“œ: "ì— ì—˜ë¹„ ì½”ë¦¬ì•„ - " ì œê±°
            else if (brand === 'M') {
                const prefix = 'ì— ì—˜ë¹„ ì½”ë¦¬ì•„ - ';
                if (pageTitle.startsWith(prefix)) {
                    return pageTitle.substring(prefix.length);
                }
            }
            // V ë¸Œëœë“œ: "ë“€ë² í‹°ì¹´ - " ì œê±°
            else if (brand === 'V') {
                const prefix = 'ë“€ë² í‹°ì¹´ - ';
                if (pageTitle.startsWith(prefix)) {
                    return pageTitle.substring(prefix.length);
                }
            }
            // ST ë¸Œëœë“œ: ì ‘ë‘ì‚¬ ì œê±° (í•„ìš”ì‹œ ìˆ˜ì •)
            else if (brand === 'ST') {
                // ST ë¸Œëœë“œì˜ ì ‘ë‘ì‚¬ëŠ” ë°ì´í„° í™•ì¸ í›„ ì¶”ê°€
                return pageTitle;
            }
            return pageTitle;
        }

        function switchTab(brand) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // íƒ­ ì½˜í…ì¸  í‘œì‹œ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${brand}`).classList.add('active');
        }

        function renderInsights(scrollDepthData, brand) {
            if (!scrollDepthData || scrollDepthData.length === 0) {
                const insightsContent = document.getElementById(`insightsContent${brand}`);
                if (insightsContent) {
                    insightsContent.innerHTML = '<p style="color:#999; text-align:center; padding:40px;">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                return;
            }

            const insightsContent = document.getElementById(`insightsContent${brand}`);
            
            // ë°ì´í„° ë¶„ì„
            const bestOverall = scrollDepthData.reduce((best, item) => {
                const rate95 = item.total_events > 0 ? (item.depth_95 / item.total_events * 100) : 0;
                const bestRate95 = best.total_events > 0 ? (best.depth_95 / best.total_events * 100) : 0;
                return rate95 > bestRate95 ? item : best;
            }, scrollDepthData[0]);

            const bestParticipation = scrollDepthData.reduce((best, item) => {
                const participation = item.page_views > 0 ? (item.total_events / item.page_views * 100) : 0;
                const bestParticipationRate = best.page_views > 0 ? (best.total_events / best.page_views * 100) : 0;
                return participation > bestParticipationRate ? item : best;
            }, scrollDepthData[0]);

            const worstDropoff = scrollDepthData.map(item => {
                const rate25 = item.total_events > 0 ? (item.depth_25 / item.total_events * 100) : 0;
                const rate50 = item.total_events > 0 ? (item.depth_50 / item.total_events * 100) : 0;
                const dropoff = rate25 - rate50;
                return {...item, dropoff};
            }).reduce((worst, item) => item.dropoff > worst.dropoff ? item : worst);

            const bestStable = scrollDepthData.map(item => {
                const rate25 = item.total_events > 0 ? (item.depth_25 / item.total_events * 100) : 0;
                const rate50 = item.total_events > 0 ? (item.depth_50 / item.total_events * 100) : 0;
                const stability = rate25 - rate50; // ë‚®ì„ìˆ˜ë¡ ì•ˆì •ì 
                return {...item, stability};
            }).reduce((best, item) => item.stability < best.stability ? item : best);

            const worstFinal = scrollDepthData.reduce((worst, item) => {
                const rate95 = item.total_events > 0 ? (item.depth_95 / item.total_events * 100) : 0;
                const worstRate95 = worst.total_events > 0 ? (worst.depth_95 / worst.total_events * 100) : 0;
                return rate95 < worstRate95 ? item : worst;
            }, scrollDepthData[0]);

            const bestRate95 = bestOverall.total_events > 0 ? (bestOverall.depth_95 / bestOverall.total_events * 100).toFixed(1) : 0;
            const bestParticipationRate = bestParticipation.page_views > 0 ? (bestParticipation.total_events / bestParticipation.page_views * 100).toFixed(1) : 0;
            const worstDropoffRate = worstDropoff.dropoff.toFixed(1);
            const bestStabilityRate = bestStable.stability.toFixed(1);
            const worstFinalRate = worstFinal.total_events > 0 ? (worstFinal.depth_95 / worstFinal.total_events * 100).toFixed(1) : 0;

            // í˜ì´ì§€ ì œëª© ì¶”ì¶œ (ë¸Œëœë“œë³„ ì ‘ë‘ì‚¬ ì œê±°)
            const bestOverallTitle = getShortTitle(bestOverall.page_title || '', brand);
            const bestParticipationTitle = getShortTitle(bestParticipation.page_title || '', brand);
            const worstDropoffTitle = getShortTitle(worstDropoff.page_title || '', brand);
            const worstFinalTitle = getShortTitle(worstFinal.page_title || '', brand);

            insightsContent.innerHTML = `
                <div class="insight-grid">
                    <div class="insight-card excellent">
                        <h3>â­ ìš°ìˆ˜ ì‚¬ë¡€ - ìµœê³  ë„ë‹¬ë¥ </h3>
                        <ul>
                            <li><strong>${bestOverall.promotion_name}</strong></li>
                            <li>${bestOverallTitle ? '<span style="color:#667eea;">' + bestOverallTitle + '</span>' : ''}</li>
                            <li>ìµœì¢… ë„ë‹¬ë¥ (95%): <strong>${bestRate95}%</strong></li>
                            <li>ì•ˆì •ì ì¸ ìŠ¤í¬ë¡¤ íŒ¨í„´ìœ¼ë¡œ ë²¤ì¹˜ë§ˆí¬ë¡œ í™œìš© ê¶Œì¥</li>
                            <li>ì´ˆ-ì¤‘ë°˜ êµ¬ê°„ ì´íƒˆë¥ ì´ ë‚®ì•„ ì°¸ì—¬ ìœ ì§€ íš¨ê³¼ì </li>
                        </ul>
                    </div>

                    <div class="insight-card excellent">
                        <h3>ğŸš€ ìš°ìˆ˜ ì‚¬ë¡€ - ë†’ì€ ì°¸ì—¬ë„</h3>
                        <ul>
                            <li><strong>${bestParticipation.promotion_name}</strong></li>
                            <li>${bestParticipationTitle ? '<span style="color:#667eea;">' + bestParticipationTitle + '</span>' : ''}</li>
                            <li>ìŠ¤í¬ë¡¤ ì°¸ì—¬ë„: <strong>${bestParticipationRate}%</strong></li>
                            <li>í˜ì´ì§€ë·° ëŒ€ë¹„ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¹„ìœ¨ì´ ê°€ì¥ ë†’ìŒ</li>
                            <li>ì´ˆê¸° í™”ë©´ êµ¬ì„±ì´ ì‚¬ìš©ìì˜ ìŠ¤í¬ë¡¤ ì˜ìš•ì„ íš¨ê³¼ì ìœ¼ë¡œ ìê·¹</li>
                        </ul>
                    </div>

                    <div class="insight-card warning">
                        <h3>âš ï¸ ê°œì„  í•„ìš” - ê¸‰ê²©í•œ ì¤‘ë°˜ ì´íƒˆ</h3>
                        <ul>
                            <li><strong>${worstDropoff.promotion_name}</strong></li>
                            <li>${worstDropoffTitle ? '<span style="color:#667eea;">' + worstDropoffTitle + '</span>' : ''}</li>
                            <li>25-50% êµ¬ê°„ ì´íƒˆë¥ : <strong>${worstDropoffRate}%p</strong></li>
                            <li>ì´ˆë°˜ ì°¸ì—¬ëŠ” ë†’ìœ¼ë‚˜ ì¤‘ë°˜ êµ¬ê°„ì—ì„œ ê¸‰ê²©í•œ ì´íƒˆ ë°œìƒ</li>
                            <li>25-50% êµ¬ê°„ ì½˜í…ì¸  ì¬êµ¬ì„± ë° CTA ë°°ì¹˜ ìµœì í™” í•„ìš”</li>
                        </ul>
                    </div>

                    <div class="insight-card alert">
                        <h3>ğŸ”´ ê°œì„  í•„ìš” - ë‚®ì€ ìµœì¢… ë„ë‹¬ë¥ </h3>
                        <ul>
                            <li><strong>${worstFinal.promotion_name}</strong></li>
                            <li>${worstFinalTitle ? '<span style="color:#667eea;">' + worstFinalTitle + '</span>' : ''}</li>
                            <li>ìµœì¢… ë„ë‹¬ë¥ (95%): <strong>${worstFinalRate}%</strong></li>
                            <li>í›„ë°˜ë¶€ ì½˜í…ì¸  ê°œì„  ë° ìµœì¢… êµ¬ê°„ ê°•í™” í•„ìš”</li>
                            <li>75-95% êµ¬ê°„ì— ê°•ë ¥í•œ CTA ë°°ì¹˜ ê¶Œì¥</li>
                        </ul>
                    </div>
                </div>

                <div style="background: #f8f9ff; padding: 20px; border-radius: 12px; margin-top: 20px;">
                    <h3 style="color: #1a1a1a; font-size: 1.1em; margin-bottom: 12px; font-weight: 600;">ğŸ“‹ ê¸°íšì „ ì œì‘ ê¶Œì¥ì‚¬í•­</h3>
                    <ul style="list-style: none; padding: 0; color: #374151; line-height: 1.8;">
                        <li style="margin-bottom: 8px;">âœ… <strong>25-50% êµ¬ê°„ ì§‘ì¤‘ ê´€ë¦¬</strong>: ì´íƒˆë¥ ì´ ê°€ì¥ ë†’ì€ êµ¬ê°„ìœ¼ë¡œ ì‹œê°ì  ë³€í™”ë‚˜ ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œ ê¶Œì¥</li>
                        <li style="margin-bottom: 8px;">âœ… <strong>ì„¹ì…˜ë³„ ì½˜í…ì¸  ë°€ë„ ê· í˜•</strong>: ${bestOverall.promotion_name}ì˜ ì•ˆì •ì ì¸ íŒ¨í„´ì„ ë²¤ì¹˜ë§ˆí¬ë¡œ í™œìš©</li>
                        <li style="margin-bottom: 8px;">âœ… <strong>ì¤‘ê°„ êµ¬ê°„ ì‹œê°ì  ë³€í™”</strong>: ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸, ì• ë‹ˆë©”ì´ì…˜ ë“±ìœ¼ë¡œ ì¬ë¯¸ ìš”ì†Œ ì¶”ê°€</li>
                        <li style="margin-bottom: 8px;">âœ… <strong>í›„ë°˜ë¶€ CTA ê°•í™”</strong>: ì™„ë…í•œ ì‚¬ìš©ìëŠ” ë†’ì€ êµ¬ë§¤ ì˜ë„ë¡œ ìµœì¢… ì „í™˜ì„ ìœ„í•œ CTA ë°°ì¹˜</li>
                    </ul>
                </div>
            `;
        }

        function renderTable(scrollDepthData, brand) {
            const tbody = document.getElementById(`scrollDepthTableBody${brand}`);
            
            if (!scrollDepthData || scrollDepthData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align:center; padding:40px; color:#999;">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            tbody.innerHTML = scrollDepthData.map((item, index) => {
                const total = item.total_events || 0;
                const depth25Rate = total > 0 ? (item.depth_25 / total * 100).toFixed(1) : 0;
                const depth50Rate = total > 0 ? (item.depth_50 / total * 100).toFixed(1) : 0;
                const depth75Rate = total > 0 ? (item.depth_75 / total * 100).toFixed(1) : 0;
                const depth95Rate = total > 0 ? (item.depth_95 / total * 100).toFixed(1) : 0;
                
                // í˜ì´ì§€ ì œëª©ì—ì„œ ë¸Œëœë“œë³„ ì ‘ë‘ì‚¬ ì œê±°
                const shortTitle = getShortTitle(item.page_title || '', brand);
                
                return `
                    <tr>
                        <td><strong>#${index + 1}</strong></td>
                        <td><strong>${item.promotion_name}</strong></td>
                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${item.page_title || ''}">
                            ${shortTitle}
                        </td>
                        <td>${item.page_views.toLocaleString()}</td>
                        <td>${item.depth_25.toLocaleString()}<br><span style="color:#999; font-size:0.9em;">(${depth25Rate}%)</span></td>
                        <td>${item.depth_50.toLocaleString()}<br><span style="color:#999; font-size:0.9em;">(${depth50Rate}%)</span></td>
                        <td>${item.depth_75.toLocaleString()}<br><span style="color:#999; font-size:0.9em;">(${depth75Rate}%)</span></td>
                        <td>${item.depth_95.toLocaleString()}<br><span style="color:#999; font-size:0.9em;">(${depth95Rate}%)</span></td>
                        <td><strong>${total.toLocaleString()}</strong></td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${depth95Rate}%"></div>
                            </div>
                            <span style="font-size:0.9em; color:#667eea;">${depth95Rate}%</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderChart(scrollDepthData, brand) {
            const ctx = document.getElementById(`scrollDepthChart${brand}`);
            if (!ctx) return;
            
            // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
            if (brand === 'X' && chartX) {
                chartX.destroy();
            } else if (brand === 'M' && chartM) {
                chartM.destroy();
            } else if (brand === 'V' && chartV) {
                chartV.destroy();
            } else if (brand === 'ST' && chartST) {
                chartST.destroy();
            }
            
            if (!scrollDepthData || scrollDepthData.length === 0) {
                return;
            }
            
            const chartCtx = ctx.getContext('2d');
            const promotionNumbers = scrollDepthData.map(item => item.promotion_name);
            const depth25Data = scrollDepthData.map(item => item.depth_25);
            const depth50Data = scrollDepthData.map(item => item.depth_50);
            const depth75Data = scrollDepthData.map(item => item.depth_75);
            const depth95Data = scrollDepthData.map(item => item.depth_95);
            
            const newChart = new Chart(chartCtx, {
                type: 'bar',
                data: {
                    labels: promotionNumbers,
                    datasets: [
                        {
                            label: '25% ë„ë‹¬',
                            data: depth25Data,
                            backgroundColor: 'rgba(102, 126, 234, 0.6)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '50% ë„ë‹¬',
                            data: depth50Data,
                            backgroundColor: 'rgba(118, 75, 162, 0.6)',
                            borderColor: 'rgba(118, 75, 162, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '75% ë„ë‹¬',
                            data: depth75Data,
                            backgroundColor: 'rgba(237, 100, 166, 0.6)',
                            borderColor: 'rgba(237, 100, 166, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '95% ë„ë‹¬',
                            data: depth95Data,
                            backgroundColor: 'rgba(255, 159, 64, 0.6)',
                            borderColor: 'rgba(255, 159, 64, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'ê¸°íšì „ë³„ ìŠ¤í¬ë¡¤ ëìŠ¤ ë„ë‹¬ ìˆ˜'
                        }
                    }
                }
            });
            
            // ì°¨íŠ¸ ê°ì²´ ì €ì¥
            if (brand === 'X') {
                chartX = newChart;
            } else if (brand === 'M') {
                chartM = newChart;
            } else if (brand === 'V') {
                chartV = newChart;
            } else if (brand === 'ST') {
                chartST = newChart;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë Œë”ë§
        // X ë¸Œëœë“œ (ë””ìŠ¤ì»¤ë²„ë¦¬) ë Œë”ë§
        renderInsights(scrollDepthDataX, 'X');
        renderTable(scrollDepthDataX, 'X');
        renderChart(scrollDepthDataX, 'X');
        
        // M ë¸Œëœë“œ (MLB) ë Œë”ë§
        renderInsights(scrollDepthDataM, 'M');
        renderTable(scrollDepthDataM, 'M');
        renderChart(scrollDepthDataM, 'M');
        
        // V ë¸Œëœë“œ (ë“€ë² í‹°ì¹´) ë Œë”ë§
        renderInsights(scrollDepthDataV, 'V');
        renderTable(scrollDepthDataV, 'V');
        renderChart(scrollDepthDataV, 'V');
        
        // ST ë¸Œëœë“œ ë Œë”ë§
        renderInsights(scrollDepthDataST, 'ST');
        renderTable(scrollDepthDataST, 'ST');
        renderChart(scrollDepthDataST, 'ST');
    </script>
</body>
</html>